<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>_server.yml for framework developers • plumber2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Schibsted_Grotesk-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/National_Park-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="server_yml_files/libs/quarto-html/popper.min.js"></script><script src="server_yml_files/libs/quarto-html/tippy.umd.min.js"></script><link href="server_yml_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="server_yml_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="_server.yml for framework developers">
<meta property="og:image" content="https://plumber2.posit.co/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/plumber.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-plumber-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn plumber2</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-plumber-">
<li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">2. Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">3. Rendering output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">4. Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">5. Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">6. Programmatic usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">7. Annotation Reference</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">8. Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">9. Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">10. Migration</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced">
<li><a class="dropdown-item" href="../articles/extending.html">Extending plumber2</a></li>
    <li><a class="dropdown-item" href="../articles/server_yml.html">The _server.yml standard</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/plumber2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>_server.yml for framework developers</h1>




      <small class="dont-index">Source: <a href="https://github.com/posit-dev/plumber2/blob/main/vignettes/server_yml.qmd" class="external-link"><code>vignettes/server_yml.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>What good is a server framework if it cannot be easily deployed? After all, surely you hope that your users won’t run the amazing servers they’ve created with your tool on the machines they developed them on?</p>
<p>Ignoring the complications around getting all the files, secrets, environment variables and libraries transferred to the machine that will eventually run the server, one big question remains: How does the machine know how to launch the server? How does it even know that the files constitute a server implementation?</p>
<p>The R language has had comparably fewer server frameworks than other languages for various reasons but this is slowly changing. This low number has meant that it has generally been a viable strategy to let the server just “know about” the various options rather than try to gather around a common standard for describing these things. But, the time is ripe and due to the lack of any standard at all, we won’t fall into the trap of <a href="https://xkcd.com/927/" class="external-link">yet another standard</a> when we now propose just that: the _server.yml standard for describing R servers.</p>
<section class="level2"><h2 id="the-standard">The standard<a class="anchor" aria-label="anchor" href="#the-standard"></a>
</h2>
<p>Recognizing that it is practically impossible to define a comprehensive standard that covers all possible settings for all current and future server frameworks in R, we propose a very “thin” standard that put the onus on the server frameworks themselves to give it meaningful structure.</p>
<section class="level3"><h3 id="the-_server-yml-file">The _server.yml file<a class="anchor" aria-label="anchor" href="#the-_server-yml-file"></a>
</h3>
<p>The core of the standard is the <code>_server.yml</code> file. This file should be placed at the root of your server specification and will (unsurprisingly) contain a YAML formatted definition of your server setup. The only required field is <code>engine</code> which should appear as the first line. This element names the package responsible for launching the server and should be installable by the server. A <code>_server.yml</code> file for a plumber2 api will have:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">engine</span><span class="kw">:</span><span class="at"> plumber2</span></span></code></pre></div>
<p>as the first line.</p>
<p>The file can (and probably should) have additional fields, but it is up to the package named in <code>engine</code> to interpret these and the standard does not name <em>any</em> additional requirements to the file.</p>
</section><section class="level3"><h3 id="the-engine">The engine<a class="anchor" aria-label="anchor" href="#the-engine"></a>
</h3>
<p>For a package to be a valid engine in a <code>_server.yml</code> file it must adhere to this one requirement: It should have a function, <code>launch_server(settings, host = NULL, port = NULL, ...)</code>, that takes the path to a <code>_server.yml</code> file as the first argument, the ip address to launch the server on as the second, and the port to serve it on as the third. The function needs not be exported. The <code>launch_server()</code> function is responsible for making sense of the provided <code>_server.yml</code> file and error if it is malformed according to the expectations the engine sets. The function should launch a server in a blocking fashion, i.e. it should not return control to R for as long as the server runs.</p>
</section><section class="level3"><h3 id="the-server">The server<a class="anchor" aria-label="anchor" href="#the-server"></a>
</h3>
<p>For a server to support serving <code>_server.yml</code>-defined R servers, it should check for the existence of such a file at the root of the deployment. It should then read the engine field and install the named package. After that it should use the <code>launch_server()</code> function to launch the server. A simple example of this logic is provided below with no error handling or anything.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu">file.exist</span><span class="op">(</span><span class="st">"_server.yml"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Figure out the engine for the server</span></span>
<span>  <span class="co"># You could probably easily do this without the yaml package</span></span>
<span>  <span class="va">engine</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"_server.yml"</span><span class="op">)</span><span class="op">$</span><span class="va">engine</span></span>
<span></span>
<span>  <span class="co"># Install the engine if not already available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="va">engine</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">engine</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Find the launch_server() function in the engine</span></span>
<span>  <span class="va">launch_server</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span></span>
<span>    <span class="st">"launch_server"</span>, </span>
<span>    envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="va">engine</span><span class="op">)</span>, </span>
<span>    mode <span class="op">=</span> <span class="st">"function"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Use the function to launch the server</span></span>
<span>  <span class="fu">launch_server</span><span class="op">(</span></span>
<span>    settings <span class="op">=</span> <span class="st">"_server.yml"</span>, </span>
<span>    host <span class="op">=</span> <span class="va">HOST_ADDR</span>, <span class="co"># Variable holding the ip address</span></span>
<span>    port <span class="op">=</span> <span class="va">PORT_NO</span>    <span class="co"># Variable holding the port number</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co"># Logic for other types of server specifications</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</section></section><section class="level2"><h2 id="recommendations-for-_server-yml-engines">Recommendations for _server.yml engines<a class="anchor" aria-label="anchor" href="#recommendations-for-_server-yml-engines"></a>
</h2>
<p>While the content besides the <code>engine</code> field is completely at the discretion of the engine developer the following are some recommendations:</p>
<section class="level3"><h3 id="file-paths">File paths<a class="anchor" aria-label="anchor" href="#file-paths"></a>
</h3>
<p>It is likely that you’d want your <code>_server.yml</code> file to point to one or more files. Make sure that all file and folder paths are interpreted as relative to the location of the <code>_server.yml</code> path rather than to the working directory of the R session.</p>
</section><section class="level3"><h3 id="options">Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h3>
<p>You should aim for a separation of server logic (usually one or more R files), and server settings. To that end, you should provide a way for the user to record settings in the <code>_server.yml</code> file so that they do not need to modify implementation files in order to change run time behavior.</p>
</section></section><section class="level2"><h2 id="case-study-plumber2">Case study: plumber2<a class="anchor" aria-label="anchor" href="#case-study-plumber2"></a>
</h2>
<p>plumber2 adheres to the <code>_server.yml</code> standard and in the following we will go through how it does so as an example for other engine developers who wish to support it.</p>
<section class="level3"><h3 id="yaml-content">YAML content<a class="anchor" aria-label="anchor" href="#yaml-content"></a>
</h3>
<p>plumber2 currently defines 3 fields besides the <code>engine</code> field:</p>
<ul>
<li>
<code>routes</code>: An array of R files or folders that contain the server logic as annotated functions and objects.</li>
<li>
<code>constructor</code>: A path to a single R file that constructs the Plumber2 object.</li>
<li>
<code>options</code>: A list of options to use for the server. These all corresponds to options that can be seen in <code>?plumber2::all_opts()</code>.</li>
</ul>
<p>plumber2 provide a function (<code><a href="../reference/create_server_yml.html">create_server_yml()</a></code>) that creates this file for you so that the user can be confident that it is formatted correctly. This is generally a good idea and also provides a place to document the content of the file.</p>
</section><section class="level3"><h3 id="launch_server">
<code>launch_server()</code><a class="anchor" aria-label="anchor" href="#launch_server"></a>
</h3>
<p>The <code>launch_server()</code> function is quite simple for plumber2 since the <code><a href="../reference/api.html">api()</a></code> constructor itself understands <code>_server.yml</code> files as input. Because of this the function looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plumber2</span><span class="fu">:::</span><span class="va">launch_server</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code><span><span class="co">#&gt; function (settings, host = NULL, port = NULL, ...)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     pa &lt;- api(settings)</span></span>
<span><span class="co">#&gt;     if (!is.null(host)) {</span></span>
<span><span class="co">#&gt;         pa$host &lt;- host</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (!is.null(port)) {</span></span>
<span><span class="co">#&gt;         pa$port &lt;- port</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     api_run(pa)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55bb3566ed68&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:plumber2&gt;</span></span></code></pre>
</div>
</div>
</section></section><section class="level2"><h2 id="supported-frameworks">Supported frameworks<a class="anchor" aria-label="anchor" href="#supported-frameworks"></a>
</h2>
<p>Below is a list with R webserver frameworks known to support the <code>_server.yml</code> standard. If you have developed a framework with support and wish for it to appear here, please create a pull request with the addition:</p>
<ul>
<li><a href="https://plumber2.posit.co">plumber2</a></li>
<li><a href="https://fiery.data-imaginist.com" class="external-link">fiery</a></li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
