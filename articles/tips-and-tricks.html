<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tips &amp; Tricks • plumber2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tips &amp; Tricks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/annotations.html">Annotations reference</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Upgrading From Plumber</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">Programmatic Usage</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quickstart</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">Rendering Output</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">Tips &amp; Tricks</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tips &amp; Tricks</h1>
            
      

      <div class="d-none name"><code>tips-and-tricks.Rmd</code></div>
    </div>

    
    
<p><img src="files%2Fimages%2Fplumber_broken.png" style="float:right;;width:45.0%"></p>
<div class="section level2">
<h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<p>If you’ve historically used R interactively, you may find it
difficult to define functions that get executed at once without your
input as Plumber requires. There are a couple of debugging techniques to
be aware of when working on your Plumber APIs; these techniques are
equally transferable to debugging your R scripts, packages, or
reports.</p>
<div class="section level3">
<h3 id="print-debugging">Print Debugging<a class="anchor" aria-label="anchor" href="#print-debugging"></a>
</h3>
<p>Most programmers first approach debugging by adding print statements
to their code in order to inspect the state at some point. In R,
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> or <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code> can be used to print out some
state. For instance, <code>cat("i is currently: ", i)</code> could be
inserted in your code to help you ensure that the variable
<code>i</code> is what it should be at that point in your code.</p>
<p>This approach is equally viable with Plumber. However, plumber comes
with a dedicated logging infrastructure which can be leveraged for this
as well. In your handler you can use <code>server$log()</code> to log
messages for specific events. And if you use a logger backend like <a href="https://daroczig.github.io/logger/" class="external-link">logger</a>, you can set the
log level allowing you to filter messages that are shown. Using
<code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> and <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> automatically ends up
in your log as well so these are also valid logging calls.</p>
</div>
<div class="section level3">
<h3 id="router-stage-debugging">Router Stage Debugging<a class="anchor" aria-label="anchor" href="#router-stage-debugging"></a>
</h3>
<p>Similar to print debugging, we can output what plumber knows at
various stages of the processing pipeline using event handlers. We could
e.g. add logging calls to <code>before-request</code> and
<code>after-request</code> that logs what comes in and what is send
out.</p>
<p>For example, we can add these lines to our route file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @plumber</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">api</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">api</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/api_on.html">api_on</a></span><span class="op">(</span><span class="st">"before-request"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_inform</a></span><span class="op">(</span><span class="va">request</span><span class="op">$</span><span class="fu">as_message</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/api_on.html">api_on</a></span><span class="op">(</span><span class="st">"after-request"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">response</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_inform</a></span><span class="op">(</span><span class="va">response</span><span class="op">$</span><span class="fu">as_message</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If we were to execute a <code>GET</code> request on
<code>/stage_debug</code></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /stage_debug</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>we would expect to see output like:</p>
<pre><code>GET /stage_debug HTTP/1.1
Host: localhost:8080
Cookie: fiery_id=e6a4290e84ddd3eb5c429275b24423c87fb8c9ffaee230008a1ae8863cb72760

&lt;No Body&gt;

HTTP/1.1 200 OK
Vary: Accept
Date: Fri, 21 Mar 2025 08:48:09 GMT
Content-Length: 4
Content-Type: application/json

[42]</code></pre>
<p>This output shows that the route <code>/stage_debug</code> calculated
the value <code>42</code> and that the value was serialized using json.
We should expect to see that the received response has a status of
<code>200</code> and the body containing JSON matching
<code>[42]</code>.</p>
</div>
<div class="section level3">
<h3 id="interactive-debugging">Interactive Debugging<a class="anchor" aria-label="anchor" href="#interactive-debugging"></a>
</h3>
<p>Print debugging is an obvious starting point, but most developers
eventually wish for something more powerful. In R, this capacity is
built in to the <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> function. If you’re unfamiliar,
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> pauses the execution of some function and gives
you an interactive session in which you can inspect the current value of
internal variables or even proceed through your function one statement
at a time.</p>
<p>You can leverage <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> when developing your APIs
locally by adding a <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> call in one of more of your
handlers. This offers a powerful technique to use when you want to
inspect multiple different variables or interact with the current state
of things inside of your function. This is also a good way to get your
hands dirty with Plumber and get better acquainted with how things
behave at a low level. Consider the following API endpoint:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#* @get /</span></span>
<span><span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you run this API locally and then visit the API in a web browser,
you’ll see your R session switch into debug mode when the request
arrives, allowing you to look at the objects contained inside your
<code>req</code> and <code>res</code> objects.</p>
<p>While this <em>usually</em> works, the R session can become confused
by entering debugging mode while running the server. Because of this it
often better to mock the request. You can create a mocked request object
using <code><a href="https://fiery.data-imaginist.com/reference/fake_request.html" class="external-link">fiery::fake_request()</a></code> which you can populate with a
path, method, headers, and body content. You can then take this object
and send it through your API using the <code>test_request()</code>
method in your Plumber API object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">papi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/api.html">api</a></span><span class="op">(</span><span class="st">"plumber.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu">fiery</span><span class="fu">::</span><span class="fu"><a href="https://fiery.data-imaginist.com/reference/fake_request.html" class="external-link">fake_request</a></span><span class="op">(</span><span class="st">"http://localhost:8080/path/to/handler"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">papi</span><span class="op">$</span><span class="fu">test_request</span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span></code></pre></div>
<p>Be aware that the req and res objects above will not be those you are
familiar with from the handlers, but rather the formats that plumber
needs to use to interact with httpuv.</p>
</div>
</div>
<div class="section level2">
<h2 id="port-range">Port Range<a class="anchor" aria-label="anchor" href="#port-range"></a>
</h2>
<p>You can use
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>t</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>v</mi><mo>:</mo><mo>:</mo><mi>r</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi><mi>P</mi><mi>o</mi><mi>r</mi><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">httpuv::randomPort()</annotation></semantics></math>
to define a range of port for Plumber to pick from when running an
API.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plumber.R</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"plumber2.port"</span> <span class="op">=</span> <span class="fu">httpuv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/randomPort.html" class="external-link">randomPort</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">4000</span>, max <span class="op">=</span> <span class="fl">7000</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### define the rest of your plumber router...</span></span></code></pre></div>
<p>or more programmatically</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/api.html">api</a></span><span class="op">(</span>port <span class="op">=</span> <span class="fu">httpuv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/httpuv/man/randomPort.html" class="external-link">randomPort</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">4000</span>, max <span class="op">=</span> <span class="fl">7000</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/api_run.html">api_run</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
