<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add a handler for a request — api_request_handlers • plumber2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Schibsted_Grotesk-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/National_Park-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add a handler for a request — api_request_handlers"><meta name="description" content="This family of functions facilitates adding a request handler for a specific
HTTP method and path."><meta property="og:description" content="This family of functions facilitates adding a request handler for a specific
HTTP method and path."><meta property="og:image" content="https://plumber2.posit.co/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/plumber.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-plumber-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn plumber2</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-plumber-"><li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">2. Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">3. Rendering output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">4. Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">5. Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">6. Programmatic usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">7. Annotation Reference</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">8. Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">9. Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">10. Migration</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced"><li><a class="dropdown-item" href="../articles/extending.html">Extending plumber2</a></li>
    <li><a class="dropdown-item" href="../articles/server_yml.html">The _server.yml standard</a></li>
    <li><a class="dropdown-item" href="../articles/otel.html">OpenTelemetry instrumentation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/plumber2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Add a handler for a request</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/plumber2/blob/main/R/api_handlers.R" class="external-link"><code>R/api_handlers.R</code></a></small>
      <div class="d-none name"><code>api_request_handlers.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This family of functions facilitates adding a request handler for a specific
HTTP method and path.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">api_get</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_head</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_post</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_put</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_delete</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_connect</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_options</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_trace</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_patch</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_any</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-api">api<a class="anchor" aria-label="anchor" href="#arg-api"></a></dt>
<dd><p>A plumber2 api object to add the handler to</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>A string giving the path the handler responds to. See Details</p></dd>


<dt id="arg-handler">handler<a class="anchor" aria-label="anchor" href="#arg-handler"></a></dt>
<dd><p>A handler function to call when a request is matched to the
path</p></dd>


<dt id="arg-serializers">serializers<a class="anchor" aria-label="anchor" href="#arg-serializers"></a></dt>
<dd><p>A named list of serializers that can be used to format the
response before sending it back to the client. Which one is selected is based
on the request <code>Accept</code> header. See <code><a href="register_serializer.html">get_serializers()</a></code> for a helper to
construct this</p></dd>


<dt id="arg-parsers">parsers<a class="anchor" aria-label="anchor" href="#arg-parsers"></a></dt>
<dd><p>A named list of parsers that can be used to parse the
request body before passing it in as the <code>body</code> argument. Which one is
selected is based on the request <code>Content-Type</code> header. See <code><a href="register_parser.html">get_parsers()</a></code>
for a helper to construct this</p></dd>


<dt id="arg-use-strict-serializer">use_strict_serializer<a class="anchor" aria-label="anchor" href="#arg-use-strict-serializer"></a></dt>
<dd><p>By default, if a serializer that respects the
requests <code>Accept</code> header cannot be found, then the first of the provided ones
are used. Setting this to <code>TRUE</code> will instead send back a
<code>406 Not Acceptable</code> response</p></dd>


<dt id="arg-download">download<a class="anchor" aria-label="anchor" href="#arg-download"></a></dt>
<dd><p>Should the response mark itself for download instead of being
shown inline? Setting this to <code>TRUE</code> will set the <code>Content-Disposition</code>
header in the response to <code>attachment</code>. Setting it to a string is equivalent
to setting it to <code>TRUE</code> but will in addition also set the default filename of
the download to the string value</p></dd>


<dt id="arg-async">async<a class="anchor" aria-label="anchor" href="#arg-async"></a></dt>
<dd><p>If <code>FALSE</code> create a regular handler. If <code>TRUE</code>, use the default
async evaluator to create an async handler. If a string, the async evaluator
registered to that name is used. If a function is provided then this is used
as the async evaluator. See the <em>Async</em> section for more detail</p></dd>


<dt id="arg-then">then<a class="anchor" aria-label="anchor" href="#arg-then"></a></dt>
<dd><p>A list of function to be called once the async handler is done.
The functions will be chained using <code><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">promises::then()</a></code>. See the <em>Async</em>
section for more detail</p></dd>


<dt id="arg-doc">doc<a class="anchor" aria-label="anchor" href="#arg-doc"></a></dt>
<dd><p>A list with the OpenAPI spec for the endpoint</p></dd>


<dt id="arg-route">route<a class="anchor" aria-label="anchor" href="#arg-route"></a></dt>
<dd><p>The route this handler should be added to. Defaults to the last
route in the stack. If the route does not exist it will be created as the
last route in the stack</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>These functions return the <code>api</code> object allowing for easy chaining
with the pipe</p>
    </div>
    <div class="section level2">
    <h2 id="using-annotation">Using annotation<a class="anchor" aria-label="anchor" href="#using-annotation"></a></h2>
    <p>Handlers can be specified in an annotated route file using one of the method
tags followed by the path it pertains to. You can use various tags to
descripe the handler and these will automatically be converted to OpenAPI
documentation. Further, additional tags allow you to modify the behaviour of
the handler, reflecting the arguments available in the functional approach.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#* A handler for /user/&lt;username&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#* @param username:string The name of the user to provide information on</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#* @get /user/&lt;username&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#* @response 200:{name:string, age:integer, hobbies:[string]} Important</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#* information about the user such as their name, age, and hobbies</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="cf">function</span>(username) {</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">find_user_in_db</span>(username)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>Handlers can be specified in an annotated route file using one of the method
tags followed by the path it pertains to. You can use various tags to
descripe the handler and these will automatically be converted to OpenAPI
documentation. Further, additional tags allow you to modify the behaviour of
the handler, reflecting the arguments available in the functional approach.</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#* A handler for /user/&lt;username&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#* @param username:string The name of the user to provide information on</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#* @get /user/&lt;username&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#* @response 200:{name:string, age:integer, hobbies:[string]} Important</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#* information about the user such as their name, age, and hobbies</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="cf">function</span>(username) {</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">find_user_in_db</span>(username)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>}</span></code></pre><p></p></div>
<p>You can create async handlers with <code>then</code> chaining using annotation, through
the <code>@async</code> and <code>@then</code> tags</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#* A handler for /user/&lt;username&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#* @param username:string The name of the user to provide information on</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#* @get /user/&lt;username&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#* @response 200:{name:string, age:integer, hobbies:[string]} Important</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#* information about the user such as their name, age, and hobbies</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#* @async</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="cf">function</span>(username) {</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>  <span class="fu">find_user_in_db</span>(username)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#* @then</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="cf">function</span>(server, response) {</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>  server<span class="sc">$</span><span class="fu">log</span>(<span class="st">"message"</span>, <span class="st">"async operation completed"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>  response<span class="sc">$</span><span class="fu">set_header</span>(<span class="st">"etag"</span>, <span class="st">"abcdef"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>  Next</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>}</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="http-methods">HTTP Methods<a class="anchor" aria-label="anchor" href="#http-methods"></a></h2>
    <p>The HTTP specs provide a selection of specific methods that clients can send
to the server (your plumber api). While there is no enforcement that the
server follows any conventions you should strive to create a server API that
adheres to common expectations. It is not required that a server understands
all methods, most often the opposite is true. The HTTP methods are described
below, but consider consulting <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods" class="external-link">MDN</a>
to get acquainted with the HTTP spec in general</p><ul><li><p><code>GET</code>: This method is used to request specific content and is perhaps the
most ubiquitous method in use. <code>GET</code> requests should only retrieve data and
should not contain any body content</p></li>
<li><p><code>HEAD</code>: This method is identical to <code>GET</code>, except the response should only
contain headers, no body. Apart from this it is expected that a <code>HEAD</code>
request is identical to a <code>GET</code> request for the same resource</p></li>
<li><p><code>POST</code>: This method delivers content, in the form of a request body, to the
server, potentially causing a change in the server. In the context of
plumber2 it is often used to call functions that require input larger than
what can be put in the URL</p></li>
<li><p><code>PUT</code>: This method is used to update a specific resource on the server. In
the context of a standard plumber2 server this is rarely relevant, though
usage can come up. <code>PUT</code> is considered by clients to be indemptotent meaning
that sending the same <code>PUT</code> request multiple times have no effect</p></li>
<li><p><code>DELETE</code>: This method deletes a resource and is the opposite to <code>PUT</code>. As
with <code>PUT</code> this method has limited use in most standard plumber2 servers</p></li>
<li><p><code>CONNECT</code>: This method request the establishment of a proxy tunnel. It is
considered advanced use and is very unlikely to have a usecase for your
plumber2 api</p></li>
<li><p><code>OPTIONS</code>: This method is used by clients to query a server about what
methods and other settings are supported on a server</p></li>
<li><p><code>TRACE</code>: This method is a form of ping that should send a response
containing the request (stripped of any sensitive information). Many
servers disallow this method due to security concerns</p></li>
<li><p><code>PATCH</code>: This method is like <code>PUT</code> but allows partial modification of a
resource</p></li>
</ul><p>Apart from the above, plumber2 also understands the <code>ANY</code> method which
responds to requests to any of the above methods, assuming that a specific
handler for the method is not found. As the semantics of the various methods
are quite different an <code>ANY</code> handler should mainly be used for rejections or
for setting specific broad headers on the response, not as the main handler
for the request</p>
    </div>
    <div class="section level2">
    <h2 id="the-path">The Path<a class="anchor" aria-label="anchor" href="#the-path"></a></h2>
    <p>The path defines the URL the request is being made to with the root removed.
If your plumber2 server runs from <code>http://example.com/api/</code> and a request is
made to <code>http://example.com/api/user/thomas/</code>, then the path would be
<code>user/thomas/</code>. Paths can be static like the prior example, or dynamic as
described below:</p><div class="section">
<h3 id="path-arguments">Path arguments<a class="anchor" aria-label="anchor" href="#path-arguments"></a></h3>


<p>Consider you have a bunch of users. It would be impractical to register a
handler for each one of them. Instead you can use a dynamic path like with
the following syntax: <code>user/&lt;username&gt;/</code>. This path would be matched to any
requests made to <code>user/..something../</code>. The actual value of <code>..something..</code>
(e.g. <code>thomas</code>) would be made available to the handler (see below). A path
can contain multiple arguments if needed, such as
<code>user/&lt;username&gt;/settings/&lt;setting&gt;/</code></p>
</div>

<div class="section">
<h3 id="path-wildcards">Path wildcards<a class="anchor" aria-label="anchor" href="#path-wildcards"></a></h3>


<p>Apart from path arguments it is also possible to be even less specific by
adding a wildcard to the path. The path <code>user/*</code> will match both
<code>user/thomas/</code>, <code>user/thomas/settings/interests/</code>, and anything other path
that begins with <code>user/</code>. As with arguments a path can contain multiple
wildcards but the use of these have very diminishing returns. Contrary to
path arguments the value(s) corresponding to <code>*</code> is not made available to the
handler.</p>
</div>

<div class="section">
<h3 id="path-priority">Path Priority<a class="anchor" aria-label="anchor" href="#path-priority"></a></h3>


<p>With the existence of path arguments and wildcards it is possible that
multiple handlers in a route can be matched to a single request. Since only
one can be selected we need to determine which one wins. The priority is
based on the specificity of the path. Consider a server containing the
following handler paths: <code>user/thomas/</code>, <code>user/&lt;username&gt;/</code>,
<code>user/&lt;username&gt;/settings/&lt;setting&gt;/</code>, <code>user/*</code>. These paths will have the
following priority:</p><ol><li><p><code>user/&lt;username&gt;/settings/&lt;setting&gt;/</code></p></li>
<li><p><code>user/thomas/</code></p></li>
<li><p><code>user/&lt;username&gt;/</code></p></li>
<li><p><code>user/*</code></p></li>
</ol><p>The first spot is due to the fact that it is the path with the most elements
so it is deemed most specific. For the remaining 3 they all have the same
number of elements, but static paths are considered more specific than
dynamic paths, and path arguments are considered more specific than
wildcards.</p>
<p>A request made to <code>user/carl</code> will thus end up in the third handler, while a
request made to <code>user/thomas</code> will end up in the second. This ordering makes
it possible to both provide default handlers as well as specialisations for
specific paths.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="the-handler">The Handler<a class="anchor" aria-label="anchor" href="#the-handler"></a></h2>
    <p>The handler is a standard R function that is called when a request is made
that matches the handlers path (unless a more specific handler path exists —
see above). A handler function can perform any operation a normal R function
can do, though you should consider strongly the security implications of your
handler functions. However, there are certain expectations in plumber around
the arguments a handler function takes and the return value it provides</p><div class="section">
<h3 id="handler-arguments">Handler Arguments<a class="anchor" aria-label="anchor" href="#handler-arguments"></a></h3>


<p>The handler function can take one or more of the following arguments.</p><ul><li><p><strong>Path arguments</strong>: Any path arguments are passed on to the handler. If a
handler is registered for the following path
<code>user/&lt;username&gt;/settings/&lt;setting&gt;/</code> and it handles a request to
<code>user/thomas/settings/interests/</code> then it will be called with
<code>username = "thomas", setting = "interest"</code></p></li>
<li><p><code>request</code>: The request the handler is responding to as a <a href="https://reqres.data-imaginist.com/reference/Request.html" class="external-link">reqres::Request</a>
object</p></li>
<li><p><code>response</code>: The response being returned to the client as a
<a href="https://reqres.data-imaginist.com/reference/Response.html" class="external-link">reqres::Response</a> object</p></li>
<li><p><code>server</code>: The <a href="Plumber2.html">Plumber2</a> object representing your server implementation</p></li>
<li><p><code>client_id</code>: A string uniquely identifying the session the request comes
from</p></li>
<li><p><code>query</code>: A list giving any additional arguments passed into the handler as
part of the url query string</p></li>
<li><p><code>body</code>: The request body, parsed as specified by the provided parsers</p></li>
</ul></div>

<div class="section">
<h3 id="handler-return-value">Handler Return Value<a class="anchor" aria-label="anchor" href="#handler-return-value"></a></h3>


<p>Handlers can return a range of different value types, which will inform
plumber2 what to do next:</p><div class="section">
<h4 id="returning-next-or-break">Returning <code>Next</code> or <code>Break</code><a class="anchor" aria-label="anchor" href="#returning-next-or-break"></a></h4>


<p>These two control objects informs plumber2 to either proceed handling the
request (<code>Next</code>) or return the response as is, circumventing any remaining
routes (<code>Break</code>)</p>
</div>

<div class="section">
<h4 id="returning-null-or-the-response-object">Returning <code>NULL</code> or the <code>response</code> object<a class="anchor" aria-label="anchor" href="#returning-null-or-the-response-object"></a></h4>


<p>This is the same as returning <code>Next</code>, i.e. it signals that handling can
proceed</p>
</div>

<div class="section">
<h4 id="returning-a-ggplot-object">Returning a ggplot2 object<a class="anchor" aria-label="anchor" href="#returning-a-ggplot-object"></a></h4>


<p>If you return a ggplot2 object it will get plotted for you (and added to the
response assuming a graphics serializer is provided) before handling
continues</p>
</div>

<div class="section">
<h4 id="returning-any-other-value">Returning any other value<a class="anchor" aria-label="anchor" href="#returning-any-other-value"></a></h4>


<p>Any kind of value returned that is not captured by the above description will
be set to the response body (overwriting what was already there) and
handling is then allowed to continue</p>
</div>


</div>

<div class="section">
<h3 id="handler-conditions">Handler conditions<a class="anchor" aria-label="anchor" href="#handler-conditions"></a></h3>


<p>Like any function in R, a handler may need to signal that something happened,
either by throwing an error or warning or by emitting a message. You can use
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>, <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>, and <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> as you are used to. For all of them,
the condition message will end up in the log. Further, for <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> any
further handling of the request will end and a <code>500 Internal Error</code> response
is returned. To take more control over problems you can use the
<code><a href="https://reqres.data-imaginist.com/reference/abort_http_problem.html" class="external-link">abort_*()</a></code> family of conditions from reqres. Like <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>
they will halt any further processing, but they also allow control over what
kind of response is sent back, what kind of information about the issue is
communicated to the client, and what kind of information is logged
internally. The response they send back (except for <code><a href="https://reqres.data-imaginist.com/reference/abort_http_problem.html" class="external-link">abort_status()</a></code>) all
adhere to the HTTP Problem spec defined in
<a href="https://datatracker.ietf.org/doc/html/rfc9457" class="external-link">RFC 9457</a>.</p>
<p>While it may feel like a good idea to send a detailed error message back to
the client it is often better to only inform the client of what they need to
change to solve the issue. Too much information about internal implementation
details can be a security risk and forwarding internal errors to a client can
help inform the client about how the server has been implemented.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="async-handling">Async handling<a class="anchor" aria-label="anchor" href="#async-handling"></a></h2>
    <p>plumber2 supports async handling of requests in one of two ways:</p><ol><li><p>The handler you provide returns a promise object</p></li>
<li><p>You set <code>async = TRUE</code> (or the name of a registered async evaluator) when
adding the handler</p></li>
</ol><p>For 1), there is no more to do. You have full custody over the created
promise and any <code>then()</code>-chaining that might be added to it. For 2) it is a
bit different. In that case you provide a regular function and plumber2 takes
care of converting it to a promise. Due to the nature of promises a handler
being converted to a promise can't take <code>request</code>, <code>response</code>, and <code>server</code>
arguments, so if you need to manipulate these you need to use <code>then</code> (more on
this shortly). The async handler should yield the value that the response
should ultimately get assigned to the body or have plotting side effects (in
which case the plot will get added to the response).</p><div class="section">
<h3 id="async-chaining">Async chaining<a class="anchor" aria-label="anchor" href="#async-chaining"></a></h3>


<p>Because you can't manipulate <code>request</code> <code>response</code>, or <code>server</code> in the async
handler it may be needed to add operations to perform once the async handler
has finished. This can be done through the <code>then</code> argument (or using the
<code>@then</code> tag in annotated route files). This takes a list of functions to
chain to the promise using <code><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">promises::then()</a></code>. Before the <code>then</code> chain is
executed the response will get the return value of the main handler asigned
to the body. Each <code>then</code> call will receive the same arguments as a standard
request handler as well as <code>result</code> which will hold the return value of the
previous handler in the chain. For the first <code>then</code> call <code>result</code> will be a
boolean signalling if the async handler wants request handling to proceed to
the next route or terminate early. The last call in the chain must return
<code>Next</code> or <code>Break</code> to signal if processing should be allowed to continue to
the next route.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Request Handlers:
<code><a href="api_request_header_handlers.html">api_request_header_handlers</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Standard use</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_get</span><span class="op">(</span><span class="st">"/hello/&lt;name:string&gt;"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      msg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello "</span>, <span class="va">name</span>, <span class="st">"!"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating <span style="color: #00BB00;">default</span> route in request router</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── A plumber server ────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Serving on http://127.0.0.1:8080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Currently <span style="color: #BB0000;">not running</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify serializers</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_get</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"/hello/&lt;name:string&gt;"</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>        msg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Hello "</span>, <span class="va">name</span>, <span class="st">"!"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    serializers <span class="op">=</span> <span class="fu"><a href="register_serializer.html">get_serializers</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"json"</span>, <span class="st">"xml"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating <span style="color: #00BB00;">default</span> route in request router</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── A plumber server ────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Serving on http://127.0.0.1:8080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Currently <span style="color: #BB0000;">not running</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Request a download and make it async</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_get</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"/the_plot"</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    serializers <span class="op">=</span> <span class="fu"><a href="register_serializer.html">get_serializers</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"png"</span>, <span class="st">"jpeg"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    download <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    async <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating <span style="color: #00BB00;">default</span> route in request router</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── A plumber server ────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Serving on http://127.0.0.1:8080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Currently <span style="color: #BB0000;">not running</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

