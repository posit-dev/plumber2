<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add auth to an endpoint — api_auth • plumber2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Schibsted_Grotesk-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/National_Park-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add auth to an endpoint — api_auth"><meta name="description" content="This function adds auth to a specific method + path. It does so by
defining an auth flow which the request must pass in order to proceed, as
well as an optional vector of scopes required. The flow is given as a logical
expression of guards it must satisfy. If you
have registered two guards, auth1 and auth2, then a flow could be
auth1 &amp;amp;&amp;amp; auth2 to require that both guards must be passed to gain
access. Alternatively you could use auth1 || auth2 to require that just one
of them are passed. Flows can be arbitrarily complex with nesting etc, but
the OpenAPI spec has limits to what it can describe so if you want to have an
OpenAPI compliant api you must limit yourself to at most two levels of
nesting with the outer level being || (ie.
(auth1 &amp;amp;&amp;amp; auth2) || (auth3 &amp;amp;&amp;amp; auth4) is ok, but
(auth1 || auth2) &amp;amp;&amp;amp; (auth3 || auth4) is not due to the outer level being
&amp;amp;&amp;amp;, and (auth1 &amp;amp;&amp;amp; auth2) || (auth3 &amp;amp;&amp;amp; (auth4 || auth5)) is not allowed
because it has 3 nesting levels). This is only a limitation of OpenAPI and
plumber2 itself can handle all of the above. If scope is given the scope of
the user after successful authentication must contain all of the provided
scopes. While this function allows you to add authentication to a path
directly, it is often more convenient to add it along with the resource or
functionality you want to protect. To that end, many functions such as
api_get() and api_report() also takes auth_flow and auth_scope as
input and if given will add auth to the relevant endpoint."><meta property="og:description" content="This function adds auth to a specific method + path. It does so by
defining an auth flow which the request must pass in order to proceed, as
well as an optional vector of scopes required. The flow is given as a logical
expression of guards it must satisfy. If you
have registered two guards, auth1 and auth2, then a flow could be
auth1 &amp;amp;&amp;amp; auth2 to require that both guards must be passed to gain
access. Alternatively you could use auth1 || auth2 to require that just one
of them are passed. Flows can be arbitrarily complex with nesting etc, but
the OpenAPI spec has limits to what it can describe so if you want to have an
OpenAPI compliant api you must limit yourself to at most two levels of
nesting with the outer level being || (ie.
(auth1 &amp;amp;&amp;amp; auth2) || (auth3 &amp;amp;&amp;amp; auth4) is ok, but
(auth1 || auth2) &amp;amp;&amp;amp; (auth3 || auth4) is not due to the outer level being
&amp;amp;&amp;amp;, and (auth1 &amp;amp;&amp;amp; auth2) || (auth3 &amp;amp;&amp;amp; (auth4 || auth5)) is not allowed
because it has 3 nesting levels). This is only a limitation of OpenAPI and
plumber2 itself can handle all of the above. If scope is given the scope of
the user after successful authentication must contain all of the provided
scopes. While this function allows you to add authentication to a path
directly, it is often more convenient to add it along with the resource or
functionality you want to protect. To that end, many functions such as
api_get() and api_report() also takes auth_flow and auth_scope as
input and if given will add auth to the relevant endpoint."><meta property="og:image" content="https://plumber2.posit.co/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/plumber.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-plumber-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn plumber2</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-plumber-"><li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">2. Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">3. Rendering output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">4. Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">5. Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">6. Programmatic usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">7. Annotation Reference</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">8. Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">9. Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">10. Migration</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-advanced" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Advanced</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-advanced"><li><a class="dropdown-item" href="../articles/extending.html">Extending plumber2</a></li>
    <li><a class="dropdown-item" href="../articles/server_yml.html">The _server.yml standard</a></li>
    <li><a class="dropdown-item" href="../articles/otel.html">OpenTelemetry instrumentation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/plumber2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Add auth to an endpoint</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/plumber2/blob/main/R/api_auth.R" class="external-link"><code>R/api_auth.R</code></a></small>
      <div class="d-none name"><code>api_auth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function adds auth to a specific method + path. It does so by
defining an auth flow which the request must pass in order to proceed, as
well as an optional vector of scopes required. The flow is given as a logical
expression of <a href="api_auth_guard.html">guards</a> it must satisfy. If you
have registered two guards, <code>auth1</code> and <code>auth2</code>, then a flow could be
<code>auth1 &amp;&amp; auth2</code> to require that both guards must be passed to gain
access. Alternatively you could use <code>auth1 || auth2</code> to require that just one
of them are passed. Flows can be arbitrarily complex with nesting etc, but
the OpenAPI spec has limits to what it can describe so if you want to have an
OpenAPI compliant api you must limit yourself to at most two levels of
nesting with the outer level being <code>||</code> (ie.
<code>(auth1 &amp;&amp; auth2) || (auth3 &amp;&amp; auth4)</code> is ok, but
<code>(auth1 || auth2) &amp;&amp; (auth3 || auth4)</code> is not due to the outer level being
<code>&amp;&amp;</code>, and <code>(auth1 &amp;&amp; auth2) || (auth3 &amp;&amp; (auth4 || auth5))</code> is not allowed
because it has 3 nesting levels). This is only a limitation of OpenAPI and
plumber2 itself can handle all of the above. If scope is given the scope of
the user after successful authentication must contain <em>all</em> of the provided
scopes. While this function allows you to add authentication to a path
directly, it is often more convenient to add it along with the resource or
functionality you want to protect. To that end, many functions such as
<code><a href="api_request_handlers.html">api_get()</a></code> and <code><a href="api_report.html">api_report()</a></code> also takes <code>auth_flow</code> and <code>auth_scope</code> as
input and if given will add auth to the relevant endpoint.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">api_auth</span><span class="op">(</span><span class="va">api</span>, <span class="va">method</span>, <span class="va">path</span>, <span class="va">auth_flow</span>, auth_scope <span class="op">=</span> <span class="cn">NULL</span>, add_doc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-api">api<a class="anchor" aria-label="anchor" href="#arg-api"></a></dt>
<dd><p>A plumber2 api object to add authentication to</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>The HTTP method to add authentication to</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>A string giving the path to be authenticated</p></dd>


<dt id="arg-auth-flow">auth_flow<a class="anchor" aria-label="anchor" href="#arg-auth-flow"></a></dt>
<dd><p>A logical expression giving the authentication flow the
client must pass to get access to the resource.</p></dd>


<dt id="arg-auth-scope">auth_scope<a class="anchor" aria-label="anchor" href="#arg-auth-scope"></a></dt>
<dd><p>The scope requirements of the resource</p></dd>


<dt id="arg-add-doc">add_doc<a class="anchor" aria-label="anchor" href="#arg-add-doc"></a></dt>
<dd><p>Should OpenAPI documentation be added for the
authentication</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This functions return the <code>api</code> object allowing for easy chaining
with the pipe</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># We are not adding the guards here - only the auth flow</span></span></span>
<span class="r-in"><span><span class="co"># We assume the guards `oauth`, `basic`, and `key` will be added</span></span></span>
<span class="r-in"><span><span class="co"># later</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="api_datastore.html">api_datastore</a></span><span class="op">(</span><span class="fu">storr</span><span class="fu">::</span><span class="fu"><a href="https://richfitz.github.io/storr/reference/storr_environment.html" class="external-link">driver_environment</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_auth</span><span class="op">(</span></span></span>
<span class="r-in"><span>    method <span class="op">=</span> <span class="st">"get"</span>,</span></span>
<span class="r-in"><span>    path <span class="op">=</span> <span class="st">"/user/&lt;username&gt;"</span>,</span></span>
<span class="r-in"><span>    auth_flow <span class="op">=</span> <span class="va">oauth</span> <span class="op">||</span> <span class="op">(</span><span class="va">basic</span> <span class="op">&amp;&amp;</span> <span class="va">key</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── A plumber server ────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Serving on http://127.0.0.1:8080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Currently <span style="color: #BB0000;">not running</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

