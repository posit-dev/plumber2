<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add a handler for a request header — api_request_header_handlers • plumber2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add a handler for a request header — api_request_header_handlers"><meta name="description" content="These handlers are called before the request body has been recieved and lets
you preemptively reject requests before recieving their full content. If the
handler does not return Next then the request will be returned at once.
Most of your logic, however, will be in the main handlers and you are asked to
consult the api_request_handlers docs for in-depth details on how to use
request handlers in general."><meta property="og:description" content="These handlers are called before the request body has been recieved and lets
you preemptively reject requests before recieving their full content. If the
handler does not return Next then the request will be returned at once.
Most of your logic, however, will be in the main handlers and you are asked to
consult the api_request_handlers docs for in-depth details on how to use
request handlers in general."><meta property="og:image" content="https://plumber2.posit.co/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/plumber.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-plumber-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn plumber2</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-plumber-"><li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">2. Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">3. Rendering output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">4. Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">5. Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">6. Programmatic usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">7. Annotation Reference</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">8. Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">9. Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">10. Migration</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/plumber2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Add a handler for a request header</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/plumber2/blob/main/R/api_handlers.R" class="external-link"><code>R/api_handlers.R</code></a></small>
      <div class="d-none name"><code>api_request_header_handlers.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These handlers are called before the request body has been recieved and lets
you preemptively reject requests before recieving their full content. If the
handler does not return <a href="Next.html">Next</a> then the request will be returned at once.
Most of your logic, however, will be in the main handlers and you are asked to
consult the <a href="api_request_handlers.html">api_request_handlers</a> docs for in-depth details on how to use
request handlers in general.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">api_get_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_head_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_post_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_put_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_delete_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_connect_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_options_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_trace_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_patch_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">api_any_header</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">handler</span>,</span>
<span>  serializers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parsers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_strict_serializer <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  download <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  then <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-api">api<a class="anchor" aria-label="anchor" href="#arg-api"></a></dt>
<dd><p>A plumber2 api object to add the handler to</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>A string giving the path the handler responds to. See Details</p></dd>


<dt id="arg-handler">handler<a class="anchor" aria-label="anchor" href="#arg-handler"></a></dt>
<dd><p>A handler function to call when a request is matched to the
path</p></dd>


<dt id="arg-serializers">serializers<a class="anchor" aria-label="anchor" href="#arg-serializers"></a></dt>
<dd><p>A named list of serializers that can be used to format the
response before sending it back to the client. Which one is selected is based
on the request <code>Accept</code> header. See <code><a href="register_serializer.html">get_serializers()</a></code> for a helper to
construct this</p></dd>


<dt id="arg-parsers">parsers<a class="anchor" aria-label="anchor" href="#arg-parsers"></a></dt>
<dd><p>A named list of parsers that can be used to parse the
request body before passing it in as the <code>body</code> argument. Which one is
selected is based on the request <code>Content-Type</code> header. See <code><a href="register_parser.html">get_parsers()</a></code>
for a helper to construct this</p></dd>


<dt id="arg-use-strict-serializer">use_strict_serializer<a class="anchor" aria-label="anchor" href="#arg-use-strict-serializer"></a></dt>
<dd><p>By default, if a serializer that respects the
requests <code>Accept</code> header cannot be found, then the first of the provided ones
are used. Setting this to <code>TRUE</code> will instead send back a
<code>406 Not Acceptable</code> response</p></dd>


<dt id="arg-download">download<a class="anchor" aria-label="anchor" href="#arg-download"></a></dt>
<dd><p>Should the response mark itself for download instead of being
shown inline? Setting this to <code>TRUE</code> will set the <code>Content-Disposition</code>
header in the response to <code>attachment</code>. Setting it to a string is equivalent
to setting it to <code>TRUE</code> but will in addition also set the default filename of
the download to the string value</p></dd>


<dt id="arg-async">async<a class="anchor" aria-label="anchor" href="#arg-async"></a></dt>
<dd><p>If <code>FALSE</code> create a regular handler. If <code>TRUE</code>, use the default
async evaluator to create an async handler. If a string, the async evaluator
registered to that name is used. If a function is provided then this is used
as the async evaluator. See the <em>Async</em> section for more detail</p></dd>


<dt id="arg-then">then<a class="anchor" aria-label="anchor" href="#arg-then"></a></dt>
<dd><p>A list of function to be called once the async handler is done.
The functions will be chained using <code><a href="https://rstudio.github.io/promises/reference/then.html" class="external-link">promises::then()</a></code>. See the <em>Async</em>
section for more detail</p></dd>


<dt id="arg-route">route<a class="anchor" aria-label="anchor" href="#arg-route"></a></dt>
<dd><p>The route this handler should be added to. Defaults to the last
route in the stack. If the route does not exist it will be created as the
last route in the stack</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>These functions return the <code>api</code> object allowing for easy chaining
with the pipe</p>
    </div>
    <div class="section level2">
    <h2 id="using-annotation">Using annotation<a class="anchor" aria-label="anchor" href="#using-annotation"></a></h2>
    <p>Adding request header handler is done in the same way as for <a href="api_request_handlers.html">standard request handlers</a>. The only difference is that you
include a <code>@header</code> tag as well. It is not normal to document header requests
as they usually exist as internal controls. You can add <code>@noDoc</code> to avoid
generating OpenAPI docs for the handler</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#* A header handler authorizing users</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#* @get /*</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#*</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#* @header</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#* @noDoc</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="cf">function</span>(client_id, response) {</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">user_is_allowed</span>(username)) {</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    Next</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    response<span class="sc">$</span>status <span class="ot">&lt;-</span> <span class="dv">404</span><span class="dt">L</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    Break</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>}</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Request Handlers:
<code><a href="api_request_handlers.html">api_request_handlers</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simple size limit (better to use build-in functionality)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_post_header</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"/*"</span>,</span></span>
<span class="r-in"><span>    <span class="kw">function</span><span class="op">(</span><span class="va">request</span>, <span class="va">response</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="kw">if</span> <span class="op">(</span><span class="va">request</span><span class="op">$</span><span class="fu">get_header</span><span class="op">(</span><span class="st">"content-type"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1024</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">response</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fl">413L</span></span></span>
<span class="r-in"><span>        <span class="va">Break</span></span></span>
<span class="r-in"><span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">Next</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Creating <span style="color: #00BB00;">default</span> route in header router</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ── A plumber server ────────────────────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Serving on http://127.0.0.1:8080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Currently <span style="color: #BB0000;">not running</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

