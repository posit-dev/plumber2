<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Serve Quarto and Rmarkdown documents from a plumber2 api — api_report • plumber2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Serve Quarto and Rmarkdown documents from a plumber2 api — api_report"><meta name="description" content="You can serve Quarto and Rmarkdown documents from a plumber2 api and have it
automatically render the report when requested. Reports are automatically
cached to reduce overhead. Parameterized reports are supported and parameters
can be provided either with the query string for GET requests or in the
request body for POST request. It is also possible to delete the cached
render using a DELETE request. See Details for more information"><meta property="og:description" content="You can serve Quarto and Rmarkdown documents from a plumber2 api and have it
automatically render the report when requested. Reports are automatically
cached to reduce overhead. Parameterized reports are supported and parameters
can be provided either with the query string for GET requests or in the
request body for POST request. It is also possible to delete the cached
render using a DELETE request. See Details for more information"><meta property="og:image" content="https://plumber2.posit.co/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plumber2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/plumber.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-plumber-" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn plumber2</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-plumber-"><li><a class="dropdown-item" href="../articles/introduction.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/routing-and-input.html">2. Routing &amp; Input</a></li>
    <li><a class="dropdown-item" href="../articles/rendering-output.html">3. Rendering output</a></li>
    <li><a class="dropdown-item" href="../articles/execution-model.html">4. Runtime</a></li>
    <li><a class="dropdown-item" href="../articles/hosting.html">5. Hosting</a></li>
    <li><a class="dropdown-item" href="../articles/programmatic-usage.html">6. Programmatic usage</a></li>
    <li><a class="dropdown-item" href="../articles/annotations.html">7. Annotation Reference</a></li>
    <li><a class="dropdown-item" href="../articles/security.html">8. Security</a></li>
    <li><a class="dropdown-item" href="../articles/tips-and-tricks.html">9. Tips &amp; Tricks</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">10. Migration</a></li>
    <li><a class="dropdown-item" href="../articles/extending.html">11. Extending plumber2</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/plumber2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Serve Quarto and Rmarkdown documents from a plumber2 api</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/plumber2/blob/main/R/api_handlers.R" class="external-link"><code>R/api_handlers.R</code></a></small>
      <div class="d-none name"><code>api_report.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>You can serve Quarto and Rmarkdown documents from a plumber2 api and have it
automatically render the report when requested. Reports are automatically
cached to reduce overhead. Parameterized reports are supported and parameters
can be provided either with the query string for GET requests or in the
request body for POST request. It is also possible to delete the cached
render using a DELETE request. See <strong>Details</strong> for more information</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">api_report</span><span class="op">(</span></span>
<span>  <span class="va">api</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">report</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  doc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_age <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  async <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  finalize <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  continue <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cache_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"plumber2_report"</span><span class="op">)</span>,</span>
<span>  cache_by_id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  route <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-api">api<a class="anchor" aria-label="anchor" href="#arg-api"></a></dt>
<dd><p>A plumber2 api to serve the report with.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>The base path to serve the report from. Additional endpoints
will be created in addition to this.</p></dd>


<dt id="arg-report">report<a class="anchor" aria-label="anchor" href="#arg-report"></a></dt>
<dd><p>The path to the report to serve</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments to <code><a href="https://quarto-dev.github.io/quarto-r/reference/quarto_render.html" class="external-link">quarto::quarto_render()</a></code> or
<code><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">rmarkdown::render()</a></code></p></dd>


<dt id="arg-doc">doc<a class="anchor" aria-label="anchor" href="#arg-doc"></a></dt>
<dd><p>An <code><a href="openapi.html">openapi_operation()</a></code> documentation for the report. Only
<code>query</code> parameters will be used and a request body will be generated from
this for the POST methods.</p></dd>


<dt id="arg-max-age">max_age<a class="anchor" aria-label="anchor" href="#arg-max-age"></a></dt>
<dd><p>The maximum age in seconds to keep a rendered report
before initiating a re-render</p></dd>


<dt id="arg-async">async<a class="anchor" aria-label="anchor" href="#arg-async"></a></dt>
<dd><p>Should rendering happen asynchronously (using mirai)</p></dd>


<dt id="arg-finalize">finalize<a class="anchor" aria-label="anchor" href="#arg-finalize"></a></dt>
<dd><p>An optional function to run before sending the response
back. The function will receive the request as the first argument, the
response as the second, and the server as the third.</p></dd>


<dt id="arg-continue">continue<a class="anchor" aria-label="anchor" href="#arg-continue"></a></dt>
<dd><p>A logical that defines whether the response is returned
directly after rendering or should be made available to subsequent routes</p></dd>


<dt id="arg-cache-dir">cache_dir<a class="anchor" aria-label="anchor" href="#arg-cache-dir"></a></dt>
<dd><p>The location of the render cache. By default a temporary
folder is created for it.</p></dd>


<dt id="arg-cache-by-id">cache_by_id<a class="anchor" aria-label="anchor" href="#arg-cache-by-id"></a></dt>
<dd><p>Should caching be scoped by the user id. If the
rendering is dependent on user-level access to different data this is
necessary to avoid data leakage.</p></dd>


<dt id="arg-route">route<a class="anchor" aria-label="anchor" href="#arg-route"></a></dt>
<dd><p>The route this handler should be added to. Defaults to the
last route in the stack. If the route does not exist it will be created
as the last route in the stack.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This functions return the <code>api</code> object allowing for easy chaining
with the pipe</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="parameterized-reports">Parameterized reports<a class="anchor" aria-label="anchor" href="#parameterized-reports"></a></h3>


<p>Parameters provided to parameterized reports are automatically type checked
and casted based on the default values in the report and the schema provided
in the <code>doc</code>. Only the <code>query</code> parameters will be used as the request body is
inferred from that. It is important to understand that for Quarto documents,
the parameters are passed through as a yaml file and thus any type not
supported by yaml will not arrive unchanged to the document. Python reports
are supported, but the type of parameters cannot be inferred from the
document so if you want type checking you will have to provided schemas for
them in the <code>doc</code>. For POST request where the parameters are provided in the
body, you must use JSON format.</p>
</div>

<div class="section">
<h3 id="multiple-outputs">Multiple outputs<a class="anchor" aria-label="anchor" href="#multiple-outputs"></a></h3>


<p>If a report has multiple different output formats then each format is
accessible through a subpath with the name of the format. The path provided
in <code>path</code> will use content negotiation through the <code>Content-Type</code> header to
select a format. In addition, a path with the file extension added to <code>path</code>
can also be used to select the specific format. For the last two, if multiple
formats share the same mime type/file extension then only the first one can
be selected.</p>
</div>

<div class="section">
<h3 id="caching">Caching<a class="anchor" aria-label="anchor" href="#caching"></a></h3>


<p>Reports are cached, by default in a temporary folder. You can chose a
different folder with the <code>cache_dir</code> argument. Cached versions can be
deleted, thus forcing a rerender upon next request, by sending a DELETE
request. A DELETE request to the main path will delete all versions of the
report, whereas a DELETE request to one of the subpaths (see above) will only
delete versions of the specific output format. All different parameterized
versions will always be deleted together. Instead of sending DELETE requests
you can also set a <code>max_age</code> which will force a rerender if the render is
older than the given argument.</p>
<p>If the content of the report is dependent on different credentials given by
the user you can cache the reports by session id so that every user will have
it rendered uniquely for them. This is important to prevent leakage of
confidential data, but also ensures that the report looks as expected for
each user.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="using-annotation">Using annotation<a class="anchor" aria-label="anchor" href="#using-annotation"></a></h2>
    <p>A report can be served using an annotated route file by using the <code>@report</code>
tag and proceeding the annotation block with the path to the report</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">#* @report /quarterly</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="st">"my/awesome/report.qmd"</span></span></code></pre><p></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># file.exists("my/awesome/report.qmd")</span></span></span>
<span class="r-in"><span><span class="fu"><a href="api.html">api</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">api_report</span><span class="op">(</span><span class="st">"/quarterly"</span>, <span class="st">"my/awesome/report.qmd"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Lin Pedersen, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

